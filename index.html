<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Internal Affairs Dashboard ‚Äî Advanced Red Theme</title>
<style>
  /* Fonts & Reset */
  *, *::before, *::after {
    box-sizing: border-box;
  }
  body {
    margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
      Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    background: #fff5f5;
    color: #3a0b0b;
    line-height: 1.5;
    min-height: 100vh;
    padding: 1rem;
  }
  h1, h2 {
    color: #8b0000;
    margin-bottom: 0.3rem;
  }
  h1 {
    font-size: 2rem;
    text-align: center;
    font-weight: 700;
  }
  h2 {
    font-size: 1.4rem;
    border-bottom: 2px solid #b22222;
    padding-bottom: 0.2rem;
  }
  .container {
    max-width: 900px;
    margin: 0 auto 3rem;
    background: #ffe5e5;
    border-radius: 15px;
    padding: 1.5rem 2rem;
    box-shadow: 0 4px 15px rgba(139,0,0,0.25);
  }
  /* Buttons */
  button {
    cursor: pointer;
    background-color: #b22222;
    color: white;
    border: none;
    padding: 0.6rem 1.2rem;
    font-size: 1rem;
    border-radius: 10px;
    transition: background-color 0.3s ease;
    user-select: none;
  }
  button:hover {
    background-color: #8b0000;
  }
  /* Inputs */
  input[type="text"], input[type="date"], select, textarea {
    font-size: 1rem;
    padding: 0.4rem 0.6rem;
    border-radius: 8px;
    border: 1.5px solid #b22222;
    width: 100%;
    margin-top: 0.3rem;
    margin-bottom: 1rem;
    outline-offset: 2px;
  }
  input[type="checkbox"] {
    transform: scale(1.3);
    margin-right: 0.5rem;
    cursor: pointer;
  }
  label {
    font-weight: 600;
  }
  /* Progress Bar */
  .progress-container {
    background: #f9d6d6;
    border-radius: 20px;
    height: 25px;
    overflow: hidden;
    margin-bottom: 1rem;
    box-shadow: inset 0 2px 4px #aa4b4b;
  }
  .progress-bar {
    background: #b22222;
    height: 100%;
    width: 0%;
    transition: width 0.5s ease-in-out;
    border-radius: 20px 0 0 20px;
  }
  .progress-text {
    text-align: center;
    font-weight: 700;
    margin-bottom: 1rem;
    color: #660000;
    font-size: 1.1rem;
  }
  /* Table styles */
  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 12px;
  }
  thead tr {
    background-color: #8b0000;
    color: white;
    font-weight: 700;
    border-radius: 12px;
  }
  thead th {
    padding: 0.8rem 0.5rem;
    text-align: left;
  }
  tbody tr {
    background: #fff0f0;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(178,34,34,0.15);
  }
  tbody td {
    padding: 0.8rem 0.5rem;
    vertical-align: middle;
  }
  tbody td button {
    background: #cc4444;
    font-size: 0.9rem;
    padding: 0.3rem 0.8rem;
    border-radius: 8px;
  }
  tbody td button:hover {
    background: #a53030;
  }
  /* Badge styles */
  .badge {
    padding: 0.3rem 0.7rem;
    border-radius: 15px;
    font-weight: 700;
    color: white;
    display: inline-block;
    min-width: 80px;
    text-align: center;
    user-select: none;
  }
  .open { background: #dc3545; }      /* Bootstrap Danger Red */
  .pending { background: #fd7e14; }   /* Orange */
  .resolved { background: #28a745; }  /* Green */
  .closed { background: #6c757d; }    /* Gray */
  .overdue { background: #b22222; }
  .followup { background: #c82333; }
  /* Responsive layout */
  @media (max-width: 650px) {
    table, thead, tbody, tr, th, td {
      display: block;
      width: 100%;
    }
    thead tr {
      display: none;
    }
    tbody tr {
      margin-bottom: 1.2rem;
      border-radius: 15px;
      box-shadow: 0 3px 15px rgba(178,34,34,0.3);
      background: #ffe5e5;
      padding: 1rem;
    }
    tbody td {
      padding: 0.3rem 0;
      position: relative;
      padding-left: 45%;
      text-align: left;
      font-weight: 600;
      border-bottom: 1px solid #b22222;
    }
    tbody td::before {
      content: attr(data-label);
      position: absolute;
      left: 0.8rem;
      top: 50%;
      transform: translateY(-50%);
      font-weight: 700;
      color: #8b0000;
      white-space: nowrap;
    }
    tbody td button {
      margin-top: 0.8rem;
      width: 100%;
    }
  }
  /* Form section */
  form {
    background: #ffe5e5;
    border-radius: 15px;
    padding: 1rem 1.5rem;
    box-shadow: inset 0 0 10px #b22222;
    margin-top: 1.5rem;
  }
  form > div {
    margin-bottom: 1rem;
  }
  /* Officer list */
  .officer-list {
    margin-top: 1rem;
    padding: 0;
    list-style: none;
  }
  .officer-list li {
    background: #b22222;
    color: white;
    margin-bottom: 0.6rem;
    padding: 0.4rem 0.7rem;
    border-radius: 12px;
    font-weight: 600;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .officer-list li button {
    background: #8b0000;
    font-size: 0.8rem;
    padding: 0.2rem 0.5rem;
  }
  /* Bar chart for breakdown */
  .breakdown {
    margin-top: 1rem;
  }
  .breakdown-item {
    margin-bottom: 0.8rem;
  }
  .breakdown-label {
    font-weight: 700;
    margin-bottom: 0.2rem;
    color: #660000;
  }
  .breakdown-bar {
    height: 20px;
    background: #b22222;
    border-radius: 12px;
    width: 0;
    transition: width 0.5s ease;
  }
  /* Alerts */
  .alert {
    background: #ffe0e0;
    border: 1.5px solid #b22222;
    color: #660000;
    padding: 0.6rem 1rem;
    border-radius: 12px;
    font-weight: 700;
    margin-bottom: 1rem;
  }
  /* Footer */
  footer {
    text-align: center;
    color: #8b0000;
    font-size: 0.85rem;
    margin-top: 3rem;
  }
  /* Navigation buttons */
  #nav-buttons {
    text-align: center;
    margin-bottom: 1rem;
  }
  #nav-buttons button {
    margin: 0 0.5rem;
    min-width: 120px;
  }
</style>
</head>
<body>

  <h1>üïµÔ∏è‚Äç‚ôÇÔ∏è Internal Affairs Dashboard</h1>

  <!-- Navigation Buttons -->
  <div id="nav-buttons" role="navigation" aria-label="Main navigation">
    <button id="btn-cases" aria-pressed="true" aria-label="Show Cases page">Cases</button>
    <button id="btn-tasks" aria-pressed="false" aria-label="Show Tasks and Tickets page">Tasks & Tickets</button>
  </div>

  <!-- Cases Page -->
  <div id="cases-page">

    <div class="container" aria-label="Progress overview">
      <h2>Progress Overview</h2>
      <div class="progress-text" id="progress-text">Loading progress...</div>
      <div class="progress-container" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-label="Case completion progress">
        <div class="progress-bar" id="progress-bar"></div>
      </div>
    </div>

    <div class="container" aria-label="Cases management">
      <h2>Cases</h2>
      <table aria-describedby="cases-desc" aria-live="polite" id="cases-table" role="table">
        <caption id="cases-desc" class="sr-only">List of Internal Affairs cases with details</caption>
        <thead>
          <tr>
            <th scope="col">Case ID</th>
            <th scope="col">Type</th>
            <th scope="col">Status</th>
            <th scope="col">Assigned Officer</th>
            <th scope="col">Due Date</th>
            <th scope="col">Follow-up</th>
            <th scope="col" style="width: 100px;">Actions</th>
          </tr>
        </thead>
        <tbody id="cases-tbody">
          <!-- Rows populated by JS -->
        </tbody>
      </table>

      <form id="case-form" aria-label="Add or update a case">
        <h3 id="form-title">Add New Case</h3>
        <input type="hidden" id="edit-index" value="-1" />
        <div>
          <label for="case-id">Case ID</label>
          <input type="text" id="case-id" placeholder="E.g. IA-010" required maxlength="10" />
        </div>
        <div>
          <label for="case-type">Type</label>
          <select id="case-type" required>
            <option value="">Select type</option>
            <option value="Abuse of Power">Abuse of Power</option>
            <option value="Misconduct">Misconduct</option>
            <option value="Corruption">Corruption</option>
            <option value="Other">Other</option>
            <option value="Blackreport">Blackreport</option>
          </select>
        </div>
        <div>
          <label for="case-status">Status</label>
          <select id="case-status" required>
            <option value="">Select status</option>
            <option value="Open">Open</option>
            <option value="Pending">Pending</option>
            <option value="Resolved">Resolved</option>
            <option value="Closed">Closed</option>
          </select>
        </div>
        <div>
          <label for="case-officer">Assigned Officer</label>
          <input type="text" id="case-officer" placeholder="Officer name" required maxlength="30" />
        </div>
        <div>
          <label for="case-due">Due Date</label>
          <input type="date" id="case-due" required />
        </div>
        <div>
          <label><input type="checkbox" id="case-followup" /> Follow-up Required</label>
        </div>

        <!-- Extra fields for Blackreport case -->
        <div id="blackreport-extra" style="display:none; margin-top:1rem; padding:0.8rem; border:1px solid #b22222; border-radius: 8px; background: #ffdede;">
          <h4>Blackreport Details</h4>
          <div>
            <label for="ban-duration">Ban Duration (days)</label>
            <input type="number" id="ban-duration" min="1" max="365" />
          </div>
          <div>
            <label for="severity">Severity</label>
            <select id="severity">
              <option value="">Select severity</option>
              <option value="Low">Low</option>
              <option value="Medium">Medium</option>
              <option value="High">High</option>
              <option value="Critical">Critical</option>
            </select>
          </div>
        </div>

        <button type="submit" id="form-submit">Add Case</button>
        <button type="button" id="form-cancel" style="display:none; margin-left: 10px; background:#660000;">Cancel Edit</button>
      </form>
    </div>

    <div class="container" aria-label="Case type breakdown">
      <h2>Case Breakdown by Type</h2>
      <div id="breakdown-container" class="breakdown" aria-live="polite" aria-atomic="true">
        <!-- Bar charts populated by JS -->
      </div>
    </div>

    <div class="container" aria-label="Officer management">
      <h2>Officers</h2>
      <ul id="officer-list" class="officer-list" aria-live="polite" aria-atomic="true">
        <!-- Officer items populated by JS -->
      </ul>
      <form id="officer-form" aria-label="Add new officer" style="margin-top:1rem;">
        <label for="officer-name">Add Officer</label>
        <input type="text" id="officer-name" placeholder="Officer name" maxlength="30" required />
        <button type="submit">Add Officer</button>
      </form>
    </div>

  </div>

  <!-- Tasks & Tickets Page -->
  <div id="tasks-page" style="display:none;">
    <div class="container" aria-label="Tasks performance">
      <h2>Tasks Performance</h2>

      <table aria-describedby="tasks-desc" aria-live="polite" id="tasks-table" role="table" style="margin-bottom:1rem;">
        <caption id="tasks-desc" class="sr-only">List of tasks and completion status per member</caption>
        <thead>
          <tr>
            <th scope="col">Task</th>
            <th scope="col">Assigned To</th>
            <th scope="col">Completed</th>
          </tr>
        </thead>
        <tbody id="tasks-tbody">
          <!-- Populated by JS -->
        </tbody>
      </table>

      <h2>Ticket Response Leaderboard</h2>
      <ul id="ticket-leaderboard" class="officer-list" aria-live="polite" aria-atomic="true">
        <!-- Populated by JS -->
      </ul>
    </div>
  </div>

  <footer>
    <p>Advanced Internal Affairs Dashboard ‚Äî Red Theme UI/UX</p>
    <p>
      Data stored locally on your browser.<br />
      To persist data on server or sync with GitHub, integrate with backend or GitHub Actions.<br />
      Refresh page to reset data.
    </p>
  </footer>

<script>
  // Data arrays (load from localStorage or default)
  let cases = JSON.parse(localStorage.getItem('ia_cases')) || [
    {id:"IA-001", type:"Abuse of Power", status:"Open", officer:"Jane Doe", due:"2025-07-10", followup:true},
    {id:"IA-002", type:"Misconduct", status:"Closed", officer:"John Smith", due:"2025-06-28", followup:false},
    {id:"IA-003", type:"Corruption", status:"Pending", officer:"Alice Chen", due:"2025-07-12", followup:true},
  ];
  let officers = JSON.parse(localStorage.getItem('ia_officers')) || ["Jane Doe","John Smith","Alice Chen"];

  // Extra Blackreport fields stored per case id
  let blackreportDetails = JSON.parse(localStorage.getItem('ia_blackreportDetails')) || {};

  // Cached DOM
  const tbody = document.getElementById('cases-tbody');
  const progressBar = document.getElementById('progress-bar');
  const progressText = document.getElementById('progress-text');
  const breakdownContainer = document.getElementById('breakdown-container');
  const officerList = document.getElementById('officer-list');
  const caseForm = document.getElementById('case-form');
  const editIndexInput = document.getElementById('edit-index');
  const formTitle = document.getElementById('form-title');
  const formSubmitBtn = document.getElementById('form-submit');
  const formCancelBtn = document.getElementById('form-cancel');

  // Extra Blackreport fields DOM
  const blackreportExtra = document.getElementById('blackreport-extra');
  const banDurationInput = document.getElementById('ban-duration');
  const severitySelect = document.getElementById('severity');

  // Form fields
  const caseIdInput = document.getElementById('case-id');
  const caseTypeSelect = document.getElementById('case-type');
  const caseStatusSelect = document.getElementById('case-status');
  const caseOfficerInput = document.getElementById('case-officer');
  const caseDueInput = document.getElementById('case-due');
  const caseFollowupCheckbox = document.getElementById('case-followup');

  // Navigation buttons & pages
  const btnCases = document.getElementById('btn-cases');
  const btnTasks = document.getElementById('btn-tasks');
  const casesPage = document.getElementById('cases-page');
  const tasksPage = document.getElementById('tasks-page');

  // Tasks and completed tasks storage
  const tasks = [
    { id: 'T1', name: 'Task 1' },
    { id: 'T2', name: 'Task 2' },
    { id: 'T3', name: 'Task 3' },
    { id: 'T4', name: 'Task 4' },
    { id: 'T5', name: 'Task 5' },
    { id: 'T6', name: 'Task 6' },
    { id: 'T7', name: 'Task 7' },
    { id: 'T8', name: 'Task 8' },
    { id: 'T9', name: 'Task 9' },
    { id: 'T10', name: 'Task 10' },
  ];
  let completedTasks = JSON.parse(localStorage.getItem('ia_completedTasks')) || {};

  // Util functions for localStorage save
  function saveData() {
    localStorage.setItem('ia_cases', JSON.stringify(cases));
    localStorage.setItem('ia_officers', JSON.stringify(officers));
    localStorage.setItem('ia_blackreportDetails', JSON.stringify(blackreportDetails));
    localStorage.setItem('ia_completedTasks', JSON.stringify(completedTasks));
  }

  // Render Cases Table
  function renderCases() {
    tbody.innerHTML = '';
    cases.forEach((c, idx) => {
      const tr = document.createElement('tr');

      // Case ID
      const tdId = document.createElement('td');
      tdId.textContent = c.id;
      tdId.setAttribute('data-label', 'Case ID');
      tr.appendChild(tdId);

      // Type
      const tdType = document.createElement('td');
      tdType.textContent = c.type;
      tdType.setAttribute('data-label', 'Type');
      tr.appendChild(tdType);

      // Status with badge and overdue highlight
      const tdStatus = document.createElement('td');
      tdStatus.setAttribute('data-label', 'Status');
      const badge = document.createElement('span');
      badge.className = 'badge ' + c.status.toLowerCase();
      badge.textContent = c.status;
      tdStatus.appendChild(badge);

      // Overdue highlight if past due date and not closed
      if (c.status.toLowerCase() !== 'closed') {
        const today = new Date().toISOString().slice(0, 10);
        if (c.due < today) {
          badge.classList.add('overdue');
          badge.textContent += ' (Overdue)';
        }
      }
      tr.appendChild(tdStatus);

      // Officer
      const tdOfficer = document.createElement('td');
      tdOfficer.textContent = c.officer;
      tdOfficer.setAttribute('data-label', 'Assigned Officer');
      tr.appendChild(tdOfficer);

      // Due Date
      const tdDue = document.createElement('td');
      tdDue.textContent = c.due;
      tdDue.setAttribute('data-label', 'Due Date');
      tr.appendChild(tdDue);

      // Follow-up
      const tdFollowup = document.createElement('td');
      tdFollowup.setAttribute('data-label', 'Follow-up');
      tdFollowup.textContent = c.followup ? 'Yes' : 'No';
      tr.appendChild(tdFollowup);

      // Actions buttons (Edit/Delete)
      const tdActions = document.createElement('td');
      tdActions.style.textAlign = 'center';

      const editBtn = document.createElement('button');
      editBtn.textContent = 'Edit';
      editBtn.title = `Edit case ${c.id}`;
      editBtn.addEventListener('click', () => startEditCase(idx));
      tdActions.appendChild(editBtn);

      const delBtn = document.createElement('button');
      delBtn.textContent = 'Delete';
      delBtn.title = `Delete case ${c.id}`;
      delBtn.style.marginLeft = '8px';
      delBtn.addEventListener('click', () => deleteCase(idx));
      tdActions.appendChild(delBtn);

      tr.appendChild(tdActions);

      tbody.appendChild(tr);
    });
  }

  // Render Progress Bar and Text
  function renderProgress() {
    if (cases.length === 0) {
      progressBar.style.width = '0%';
      progressBar.setAttribute('aria-valuenow', 0);
      progressText.textContent = 'No cases recorded yet.';
      return;
    }
    const resolvedCount = cases.filter(c => c.status.toLowerCase() === 'resolved' || c.status.toLowerCase() === 'closed').length;
    const percent = Math.round((resolvedCount / cases.length) * 100);
    progressBar.style.width = percent + '%';
    progressBar.setAttribute('aria-valuenow', percent);
    progressText.textContent = `Cases completed: ${resolvedCount} of ${cases.length} (${percent}%)`;
  }

  // Render Breakdown Bar Charts by Type
  function renderBreakdown() {
    breakdownContainer.innerHTML = '';
    if (cases.length === 0) {
      breakdownContainer.textContent = 'No cases to show.';
      return;
    }
    const typeCounts = {};
    cases.forEach(c => {
      typeCounts[c.type] = (typeCounts[c.type] || 0) + 1;
    });
    const maxCount = Math.max(...Object.values(typeCounts));
    for (const [type, count] of Object.entries(typeCounts)) {
      const itemDiv = document.createElement('div');
      itemDiv.className = 'breakdown-item';

      const label = document.createElement('div');
      label.className = 'breakdown-label';
      label.textContent = `${type} (${count})`;
      itemDiv.appendChild(label);

      const bar = document.createElement('div');
      bar.className = 'breakdown-bar';
      bar.style.width = `${(count / maxCount) * 100}%`;
      itemDiv.appendChild(bar);

      breakdownContainer.appendChild(itemDiv);
    }
  }

  // Render Officers List
  function renderOfficers() {
    officerList.innerHTML = '';
    if (officers.length === 0) {
      officerList.textContent = 'No officers added.';
      return;
    }
    officers.forEach((officer, idx) => {
      const li = document.createElement('li');
      li.textContent = officer;

      const delBtn = document.createElement('button');
      delBtn.textContent = 'Remove';
      delBtn.title = `Remove officer ${officer}`;
      delBtn.addEventListener('click', () => {
        if (confirm(`Remove officer "${officer}"? This will unassign them from all cases.`)) {
          // Remove officer
          officers.splice(idx,1);
          // Unassign from cases
          cases.forEach(c => { if(c.officer === officer) c.officer = 'Unassigned'; });
          saveData();
          renderAll();
        }
      });
      li.appendChild(delBtn);

      officerList.appendChild(li);
    });
  }

  // Add Officer Form Submit
  document.getElementById('officer-form').addEventListener('submit', e => {
    e.preventDefault();
    const input = document.getElementById('officer-name');
    const name = input.value.trim();
    if (name === '') {
      alert('Officer name cannot be empty.');
      return;
    }
    if (officers.includes(name)) {
      alert('Officer already exists.');
      return;
    }
    officers.push(name);
    input.value = '';
    saveData();
    renderAll();
  });

  // Show/hide Blackreport extra fields depending on type
  caseTypeSelect.addEventListener('change', () => {
    if (caseTypeSelect.value.toLowerCase() === 'blackreport') {
      blackreportExtra.style.display = 'block';
      banDurationInput.required = true;
      severitySelect.required = true;
    } else {
      blackreportExtra.style.display = 'none';
      banDurationInput.required = false;
      severitySelect.required = false;
    }
  });

  // Add or Update Case Form Submit
  caseForm.addEventListener('submit', e => {
    e.preventDefault();
    const id = caseIdInput.value.trim();
    const type = caseTypeSelect.value;
    const status = caseStatusSelect.value;
    const officer = caseOfficerInput.value.trim() || "Unassigned";
    const due = caseDueInput.value;
    const followup = caseFollowupCheckbox.checked;

    if (!id || !type || !status || !due) {
      alert('Please fill in all required fields.');
      return;
    }

    // If Blackreport type, check extra fields
    if (type.toLowerCase() === 'blackreport') {
      const banDuration = banDurationInput.value;
      const severity = severitySelect.value;
      if (!banDuration || !severity) {
        alert('Please fill in Blackreport ban duration and severity.');
        return;
      }
      // Save blackreport details for this case id
      blackreportDetails[id] = { banDuration: parseInt(banDuration), severity };
    } else {
      // Remove blackreport details if exists for this id
      if (blackreportDetails[id]) delete blackreportDetails[id];
    }

    // Editing existing case or adding new
    const editIndex = parseInt(editIndexInput.value);
    if (editIndex >= 0) {
      // Update case
      cases[editIndex] = { id, type, status, officer, due, followup };
    } else {
      // Check duplicate id
      if (cases.find(c => c.id === id)) {
        alert('Case ID already exists. Please choose a unique ID.');
        return;
      }
      cases.push({ id, type, status, officer, due, followup });
    }
    saveData();
    resetForm();
    renderAll();
  });

  // Reset form to add mode
  function resetForm() {
    formTitle.textContent = 'Add New Case';
    formSubmitBtn.textContent = 'Add Case';
    formCancelBtn.style.display = 'none';
    editIndexInput.value = '-1';
    caseForm.reset();
    blackreportExtra.style.display = 'none';
  }
  formCancelBtn.addEventListener('click', resetForm);

  // Start editing a case
  function startEditCase(idx) {
    const c = cases[idx];
    formTitle.textContent = `Edit Case ${c.id}`;
    formSubmitBtn.textContent = 'Update Case';
    formCancelBtn.style.display = 'inline-block';
    editIndexInput.value = idx;

    caseIdInput.value = c.id;
    caseTypeSelect.value = c.type;
    caseStatusSelect.value = c.status;
    caseOfficerInput.value = c.officer;
    caseDueInput.value = c.due;
    caseFollowupCheckbox.checked = c.followup;

    if (c.type.toLowerCase() === 'blackreport') {
      blackreportExtra.style.display = 'block';
      const br = blackreportDetails[c.id];
      if (br) {
        banDurationInput.value = br.banDuration;
        severitySelect.value = br.severity;
      } else {
        banDurationInput.value = '';
        severitySelect.value = '';
      }
    } else {
      blackreportExtra.style.display = 'none';
      banDurationInput.value = '';
      severitySelect.value = '';
    }
  }

  // Delete case
  function deleteCase(idx) {
    if (confirm(`Delete case ${cases[idx].id}?`)) {
      // Remove blackreport details if exist
      if (blackreportDetails[cases[idx].id]) delete blackreportDetails[cases[idx].id];
      cases.splice(idx, 1);
      saveData();
      renderAll();
    }
  }

  // Render All cases/officers/progress/breakdown
  function renderAll() {
    renderCases();
    renderProgress();
    renderBreakdown();
    renderOfficers();
    renderTasks();
    renderTicketLeaderboard();
  }

  // ----- TASKS & TICKETS PAGE -----

  const tasksTbody = document.getElementById('tasks-tbody');
  const ticketLeaderboard = document.getElementById('ticket-leaderboard');

  // Render Tasks Table with checkbox per officer
  function renderTasks() {
    tasksTbody.innerHTML = '';

    if (officers.length === 0) {
      const tr = document.createElement('tr');
      const td = document.createElement('td');
      td.colSpan = 3;
      td.textContent = 'No officers available. Please add officers on the Cases page.';
      td.style.textAlign = 'center';
      tr.appendChild(td);
      tasksTbody.appendChild(tr);
      return;
    }

    tasks.forEach(task => {
      // Assign task to an officer for demo: rotate assignment based on task id index
      const assignedOfficer = officers[parseInt(task.id.slice(1)) % officers.length];

      const tr = document.createElement('tr');

      // Task Name
      const tdName = document.createElement('td');
      tdName.textContent = task.name;
      tdName.setAttribute('data-label', 'Task');
      tr.appendChild(tdName);

      // Assigned Officer
      const tdAssigned = document.createElement('td');
      tdAssigned.textContent = assignedOfficer;
      tdAssigned.setAttribute('data-label', 'Assigned To');
      tr.appendChild(tdAssigned);

      // Completed Checkbox
      const tdCompleted = document.createElement('td');
      tdCompleted.setAttribute('data-label', 'Completed');
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.checked = completedTasks[assignedOfficer]?.includes(task.id) || false;
      checkbox.addEventListener('change', () => {
        if (!completedTasks[assignedOfficer]) completedTasks[assignedOfficer] = [];
        if (checkbox.checked) {
          if (!completedTasks[assignedOfficer].includes(task.id)) {
            completedTasks[assignedOfficer].push(task.id);
          }
        } else {
          completedTasks[assignedOfficer] = completedTasks[assignedOfficer].filter(tid => tid !== task.id);
        }
        localStorage.setItem('ia_completedTasks', JSON.stringify(completedTasks));
        renderTasks();
      });
      tdCompleted.appendChild(checkbox);
      tr.appendChild(tdCompleted);

      tasksTbody.appendChild(tr);
    });
  }

  // Render Ticket Leaderboard (officers by how many tickets answered)
  function renderTicketLeaderboard() {
    ticketLeaderboard.innerHTML = '';
    const ticketCounts = {};
    cases.forEach(c => {
      if (c.officer && c.officer !== 'Unassigned') {
        ticketCounts[c.officer] = (ticketCounts[c.officer] || 0) + 1;
      }
    });
    const sorted = Object.entries(ticketCounts).sort((a, b) => b[1] - a[1]);
    if (sorted.length === 0) {
      ticketLeaderboard.textContent = 'No tickets assigned yet.';
      return;
    }
    sorted.forEach(([officer, count]) => {
      const li = document.createElement('li');
      li.textContent = `${officer}: ${count} tickets answered`;
      ticketLeaderboard.appendChild(li);
    });
  }

  // Navigation Button Click Handlers
  btnCases.addEventListener('click', () => {
    casesPage.style.display = 'block';
    tasksPage.style.display = 'none';
    btnCases.setAttribute('aria-pressed', 'true');
    btnTasks.setAttribute('aria-pressed', 'false');
  });

  btnTasks.addEventListener('click', () => {
    casesPage.style.display = 'none';
    tasksPage.style.display = 'block';
    btnCases.setAttribute('aria-pressed', 'false');
    btnTasks.setAttribute('aria-pressed', 'true');
  });

  // Initial render
  renderAll();
</script>

</body>
</html>
